<div class="m-dropdown"
     :class="{ 'm--is-disabled': disabled, 'm--is-waiting': waiting, 'm--is-filterable': filterable }"
     :style="{ width: width, 'max-width': maxWidth }"
     ref="mDropdown"
     @mousedown="onMousedown"
     @mouseup="onMouseup">
    <m-input-style ref="mDropdownValue"
      v-m-popup:popper
     :label="label"
     :disabled="isDisabled"
     :waiting="waiting"
     :focus="open"
     :empty="isEmpty"
     :error="hasError"
     :valid="isValid"
     :width="width">
        <input type="text"
            ref="input"
            class="m-dropdown__input"
            :disabled="inactive"
            :readonly="!filterable"
            :placeholder="placeholder"
            @keydown.enter.prevent="onKeydownEnter($event)"
            @keydown.return.prevent="onKeydownEnter($event)"
            @keydown.esc.prevent="onKeydownEscape($event)"
            @keydown.up.prevent="onKeydownUp($event)"
            @keydown.down.prevent="onKeydownDown($event)"
            @focus="onFocus"
            @blur="onBlur"
            v-model="selectedText">

        <template slot="adjust-width-auto" v-if="width == 'auto'">{{ selectedText }}</template>
        <div slot="right-content" class="m-dropdown__arrow" :class="{ 'm--is-open': open }" v-if="!waiting">
            <m-icon-button icon-name="dropdown-arrow" button-size="22px" @keydown.enter.prevent="arrowOnKeydownEnter">
                <m-i18n k="m-dropdown:open" v-if="!open"></m-i18n>
                <m-i18n k="m-dropdown:close" v-if="open"></m-i18n>
            </m-icon-button>
        </div>
    </m-input-style>

    <m-popup placement="bottom-start"
            :disabled="inactive"
            :open.sync="open"
            :enter="transitionEnter"
            :leave="transitionLeave"
            :padding-header="false"
            :padding-body="false"
            :focus-management="false"
            :close-on-backdrop="true"
            width="100%"
            ref="popper"
            @open="onOpen">
        <template slot="header" v-if="isMqMaxS && (hasLabel || filterable)">
            <h2 class="m-dropdown__header__label" v-if="hasLabel">{{ label }}</h2>
            <div class="m-dropdown__header__research" v-if="filterable">
                <input class="m-dropdown__header__research-input"
                        type="text"
                        placeholder="Recherche"
                        ref="researchInput"
                        v-model="selectedText">
                <m-icon-button class="m-dropdown__header__research-button" icon-name="search" @click="focusOnResearchInput">
                    <m-i18n k="m-dropdown:research"></m-i18n>
                </m-icon-button>
            </div>
        </template>
        <ul class="m-dropdown__list"
            ref="items"
            :style="{ 'max-height': propMaxHeight }">
            <slot></slot>
            <m-dropdown-item v-if="!hasItems && !dirty">{{ propTextNoData }}</m-dropdown-item>
            <m-dropdown-item v-if="!hasItems && dirty">{{ propTextNoMatch }}</m-dropdown-item>
        </ul>

        <template slot="footer" v-if="hasFooterSlot">
            <slot name="footer"></slot>
        </template>
    </m-popup>

    <m-validation-message
        :disabled="isDisabled"
        :error-message="errorMessage"
        :valid-message="validMessage"
        :helper-message="helperMessage"></m-validation-message>
</div>
